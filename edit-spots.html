<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¦³å…‰åœ°é¸æŠ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="screen active">
            <div class="questionnaire-header">
                <h1>è¦³å…‰åœ°ã‚’é¸æŠ</h1>
                <p class="subtitle" id="categorySubtitle">ãŠã™ã™ã‚ã‚¹ãƒãƒƒãƒˆã‹ã‚‰é¸æŠã™ã‚‹ã‹ã€è‡ªåˆ†ã§è¿½åŠ ã—ã¦ãã ã•ã„</p>
            </div>

            <div class="spot-selection-layout">
                <!-- å·¦å´: ãŠã™ã™ã‚ã‚¹ãƒãƒƒãƒˆ -->
                <div class="recommended-section">
                    <h3 id="recommendedTitle">ãŠã™ã™ã‚ã‚¹ãƒãƒƒãƒˆ</h3>
                    <div class="spots-grid" id="recommendedSpots">
                        <div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
                    </div>
                </div>

                <!-- å³å´: ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒãƒƒãƒˆè¿½åŠ  & é¸æŠæ¸ˆã¿ -->
                <div class="sidebar">
                    <!-- ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒãƒƒãƒˆè¿½åŠ  -->
                    <div class="custom-spot-card">
                        <h3>è‡ªåˆ†ã§ã‚¹ãƒãƒƒãƒˆã‚’è¿½åŠ </h3>
                        <div class="custom-input">
                            <input type="text" id="spotName" placeholder="ã‚¹ãƒãƒƒãƒˆåã‚’å…¥åŠ›" maxlength="50">
                            <input type="text" id="spotAddress" placeholder="ä½æ‰€ã‚’å…¥åŠ›ï¼ˆä»»æ„ï¼‰" maxlength="100">
                            <textarea id="spotDescription" placeholder="èª¬æ˜ã‚’å…¥åŠ›ï¼ˆä»»æ„ï¼‰" maxlength="200" rows="2"></textarea>
                            <button class="nav-btn add-btn" onclick="addCustomSpot()">ã‚¹ãƒãƒƒãƒˆã‚’è¿½åŠ </button>
                        </div>
                    </div>

                    <!-- é¸æŠæ¸ˆã¿ã‚¹ãƒãƒƒãƒˆ -->
                    <div class="selected-spots-card">
                        <h3>é¸æŠæ¸ˆã¿ã‚¹ãƒãƒƒãƒˆ <span class="count-badge" id="selectedCount">0</span></h3>
                        <div class="selected-spots-list" id="selectedSpotsList">
                            <div class="no-selection">ã¾ã é¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="navigation-buttons">
                <button class="nav-btn" onclick="location.href='edit-category.html'">
                    <span>â†</span> æˆ»ã‚‹
                </button>
                <button class="nav-btn next-btn" onclick="proceedToPreview()" id="nextBtn" disabled>
                    ç¢ºèªã¸é€²ã‚€ <span>â†’</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // ã‚¹ãƒãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿéš›ã«ã¯JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã‚€ï¼‰
        const spotsData = {
            "categories": {
                "nature": {
                    "name": "è‡ªç„¶ãƒ»æ™¯è‰²",
                    "spots": [
                        {
                            "id": "nature_1",
                            "name": "å¯Œå£«å±±äº”åˆç›®",
                            "address": "å±±æ¢¨çœŒå—éƒ½ç•™éƒ¡é³´æ²¢æ‘",
                            "description": "æ—¥æœ¬ä¸€ã®å±±ã€å¯Œå£«å±±ã®ä¸­è…¹ã«ã‚ã‚‹çµ¶æ™¯ã‚¹ãƒãƒƒãƒˆ",
                            "image": "ğŸ”ï¸",
                            "tags": ["å±±", "çµ¶æ™¯", "ç™»å±±"]
                        },
                        {
                            "id": "nature_2", 
                            "name": "å…¼å…­åœ’",
                            "address": "çŸ³å·çœŒé‡‘æ²¢å¸‚å…¼å…­ç”º",
                            "description": "æ—¥æœ¬ä¸‰ååœ’ã®ä¸€ã¤ã§å››å­£æŠ˜ã€…ã®ç¾ã—ã•ã‚’æ¥½ã—ã‚ã‚‹",
                            "image": "ğŸŒ³",
                            "tags": ["åº­åœ’", "æ—¥æœ¬åº­åœ’", "é‡‘æ²¢"]
                        },
                        {
                            "id": "nature_3",
                            "name": "é˜¿è˜‡å±±",
                            "address": "ç†Šæœ¬çœŒé˜¿è˜‡å¸‚",
                            "description": "ä¸–ç•Œæœ‰æ•°ã®ã‚«ãƒ«ãƒ‡ãƒ©ã‚’æŒã¤æ´»ç«å±±",
                            "image": "ğŸŒ‹",
                            "tags": ["ç«å±±", "ã‚«ãƒ«ãƒ‡ãƒ©", "ç†Šæœ¬"]
                        },
                        {
                            "id": "nature_4",
                            "name": "çŸ¥åºŠäº”æ¹–",
                            "address": "åŒ—æµ·é“æ–œé‡Œéƒ¡æ–œé‡Œç”º",
                            "description": "ä¸–ç•Œéºç”£ã®çŸ¥åºŠã«ã‚ã‚‹ç¥ç§˜çš„ãªæ¹–ç¾¤",
                            "image": "ğŸï¸",
                            "tags": ["ä¸–ç•Œéºç”£", "æ¹–", "åŒ—æµ·é“"]
                        },
                        {
                            "id": "nature_5",
                            "name": "ç™½å·éƒ·",
                            "address": "å²é˜œçœŒå¤§é‡éƒ¡ç™½å·æ‘",
                            "description": "åˆæŒé€ ã‚Šã®é›†è½ãŒç¾ã—ã„ä¸–ç•Œéºç”£",
                            "image": "ğŸ¡",
                            "tags": ["ä¸–ç•Œéºç”£", "åˆæŒé€ ã‚Š", "å²é˜œ"]
                        },
                        {
                            "id": "nature_6",
                            "name": "å±‹ä¹…å³¶",
                            "address": "é¹¿å…å³¶çœŒç†Šæ¯›éƒ¡å±‹ä¹…å³¶ç”º",
                            "description": "ç¸„æ–‡æ‰ãŒã‚ã‚‹ç¥ç§˜ã®å³¶",
                            "image": "ğŸŒ²",
                            "tags": ["ä¸–ç•Œéºç”£", "å±‹ä¹…æ‰", "é¹¿å…å³¶"]
                        }
                    ]
                }
                // ä»–ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚‚åŒæ§˜ã«...
            }
        };

        let selectedSpots = [];

        function loadSpotsData() {
            console.log('ã‚¹ãƒãƒƒãƒˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ:', spotsData);
            const category = localStorage.getItem('selectedCategory') || 'nature';
            displayRecommendedSpots(category);
        }

        function displayRecommendedSpots(category) {
            const container = document.getElementById('recommendedSpots');
            const categoryData = spotsData.categories[category];
            
            if (!categoryData) {
                container.innerHTML = '<div class="error">ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ã¨ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
            document.getElementById('categorySubtitle').textContent = 
                `${categoryData.name}ã®ã‚¹ãƒãƒƒãƒˆã‹ã‚‰é¸æŠã™ã‚‹ã‹ã€è‡ªåˆ†ã§è¿½åŠ ã—ã¦ãã ã•ã„`;
            document.getElementById('recommendedTitle').textContent = 
                `${categoryData.name}ã®ãŠã™ã™ã‚ã‚¹ãƒãƒƒãƒˆ`;

            const spots = categoryData.spots || [];
            
            if (spots.length === 0) {
                container.innerHTML = '<div class="no-data">è¡¨ç¤ºã§ãã‚‹ã‚¹ãƒãƒƒãƒˆãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            container.innerHTML = spots.map(spot => `
                <div class="spot-card ${isSpotSelected(spot.id) ? 'selected' : ''}" 
                     onclick="toggleSpot('${spot.id}', '${spot.name}', '${spot.address}', '${spot.description}', '${spot.image}')">
                    <div class="spot-card-header">
                        <div class="spot-image">${spot.image}</div>
                        <div class="spot-check">${isSpotSelected(spot.id) ? 'âœ“' : '+'}</div>
                    </div>
                    <div class="spot-card-body">
                        <h4>${spot.name}</h4>
                        <p class="spot-address">${spot.address}</p>
                        <p class="spot-description">${spot.description}</p>
                        <div class="spot-tags">
                            ${(spot.tags || []).map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function isSpotSelected(spotId) {
            return selectedSpots.some(spot => spot.id === spotId);
        }

        function toggleSpot(id, name, address, description, image) {
            const index = selectedSpots.findIndex(spot => spot.id === id);
            
            if (index === -1) {
                selectedSpots.push({ 
                    id, 
                    name, 
                    address, 
                    description,
                    image,
                    isCustom: false 
                });
            } else {
                selectedSpots.splice(index, 1);
            }
            
            updateSelectedList();
            updateNextButton();
            // é¸æŠçŠ¶æ…‹ã‚’åæ˜ ã™ã‚‹ãŸã‚ã«å†è¡¨ç¤º
            const category = localStorage.getItem('selectedCategory') || 'nature';
            displayRecommendedSpots(category);
        }

        function addCustomSpot() {
            const nameInput = document.getElementById('spotName');
            const addressInput = document.getElementById('spotAddress');
            const descriptionInput = document.getElementById('spotDescription');
            
            const name = nameInput.value.trim();
            const address = addressInput.value.trim();
            const description = descriptionInput.value.trim();
            
            if (!name) {
                alert('ã‚¹ãƒãƒƒãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (selectedSpots.find(spot => spot.name === name)) {
                alert('æ—¢ã«è¿½åŠ æ¸ˆã¿ã®ã‚¹ãƒãƒƒãƒˆã§ã™');
                return;
            }
            
            const customSpot = {
                id: 'custom_' + Date.now(),
                name: name,
                address: address,
                description: description,
                image: 'ğŸ“',
                isCustom: true
            };
            
            selectedSpots.push(customSpot);
            
            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
            nameInput.value = '';
            addressInput.value = '';
            descriptionInput.value = '';
            
            updateSelectedList();
            updateNextButton();
        }

        function updateSelectedList() {
            const container = document.getElementById('selectedSpotsList');
            const selectedCount = document.getElementById('selectedCount');
            
            selectedCount.textContent = selectedSpots.length;
            
            if (selectedSpots.length === 0) {
                container.innerHTML = '<div class="no-selection">ã¾ã é¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“</div>';
                return;
            }
            
            container.innerHTML = selectedSpots.map(spot => `
                <div class="selected-item">
                    <div class="selected-item-icon">${spot.image}</div>
                    <div class="selected-item-info">
                        <div class="selected-item-name">${spot.name}</div>
                        ${spot.address ? `<div class="selected-item-address">${spot.address}</div>` : ''}
                        ${spot.isCustom ? '<div class="custom-badge">ã‚«ã‚¹ã‚¿ãƒ </div>' : ''}
                    </div>
                    <button class="remove-btn" onclick="removeSpot('${spot.id}')" title="å‰Šé™¤">Ã—</button>
                </div>
            `).join('');
        }

        function removeSpot(spotId) {
            selectedSpots = selectedSpots.filter(spot => spot.id !== spotId);
            updateSelectedList();
            updateNextButton();
            
            // JSONã‚¹ãƒãƒƒãƒˆã®å ´åˆã¯è¡¨ç¤ºã‚‚æ›´æ–°
            const category = localStorage.getItem('selectedCategory') || 'nature';
            displayRecommendedSpots(category);
        }

        function updateNextButton() {
            const nextBtn = document.getElementById('nextBtn');
            nextBtn.disabled = selectedSpots.length === 0;
        }

        function proceedToPreview() {
            if (selectedSpots.length === 0) {
                alert('å°‘ãªãã¨ã‚‚1ã¤ã®ã‚¹ãƒãƒƒãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            localStorage.setItem('selectedSpots', JSON.stringify(selectedSpots));
            location.href = 'edit-preview.html';
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰
        document.addEventListener('DOMContentLoaded', loadSpotsData);
    </script>
</body>
</html>