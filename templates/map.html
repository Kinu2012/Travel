<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>çµŒè·¯æ¤œç´¢ - åœ°å›³è¡¨ç¤º</title>
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f5f5;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: relative;
    }
    
    .header h1 {
      font-size: 24px;
      margin-bottom: 5px;
    }
    
    .header p {
      font-size: 14px;
      opacity: 0.9;
    }
    
    .back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      background: white;
      color: #667eea;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: all 0.3s;
    }
    
    .back-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    
    .loading {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.9);
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 14px;
      display: none;
    }
    
    .loading.active {
      display: block;
    }
    
    #map {
      height: calc(100vh - 80px);
      width: 100%;
    }
    
    .leaflet-popup-content {
      margin: 10px;
      line-height: 1.6;
    }
    
    .popup-title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 5px;
      color: #333;
    }
    
    .popup-type {
      display: inline-block;
      background: #667eea;
      color: white;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
      margin-bottom: 5px;
    }
    
    .popup-address {
      font-size: 13px;
      color: #666;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div class="header">
    <button class="back-btn" onclick="location.href='index.html'">â† æˆ»ã‚‹</button>
    <h1>çµŒè·¯æ¤œç´¢</h1>
    <p>è¿‘ç•¿åœ°æ–¹ã®è¦³å…‰ã‚¹ãƒãƒƒãƒˆï¼ˆ300ä»¶ï¼‰</p>
    <div class="loading" id="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
  </div>
  
  <!-- åœ°å›³è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
  <div id="map"></div>
  
  <!-- Leaflet JavaScript -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <script>
    // åœ°å›³ã®åˆæœŸè¨­å®šï¼ˆè¿‘ç•¿åœ°æ–¹ã®ä¸­å¿ƒï¼‰
    var map = L.map('map').setView([34.8, 135.5], 9);
    
    // OpenStreetMapã®ã‚¿ã‚¤ãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ 
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors',
      maxZoom: 19
    }).addTo(map);
    
    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
    const loading = document.getElementById('loading');
    loading.classList.add('active');
    
    // ã‚¹ãƒãƒƒãƒˆã‚¿ã‚¤ãƒ—åˆ¥ã®ã‚¢ã‚¤ã‚³ãƒ³è‰²è¨­å®š
    function getMarkerColor(type) {
      const colors = {
        'åŸ': '#8B4513',
        'å¯ºé™¢': '#FF6347',
        'ç¥ç¤¾': '#FF4500',
        'åšç‰©é¤¨': '#4682B4',
        'ãƒ†ãƒ¼ãƒãƒ‘ãƒ¼ã‚¯': '#FF1493',
        'è¦³å…‰åœ°': '#32CD32',
        'other': '#808080'
      };
      return colors[type] || colors['other'];
    }
    
    // ã‚«ã‚¹ã‚¿ãƒ ã‚¢ã‚¤ã‚³ãƒ³ä½œæˆ
    function createCustomIcon(type) {
      const color = getMarkerColor(type);
      return L.divIcon({
        className: 'custom-icon',
        html: `<div style="
          background-color: ${color};
          width: 12px;
          height: 12px;
          border-radius: 50%;
          border: 2px solid white;
          box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        "></div>`,
        iconSize: [12, 12],
        iconAnchor: [6, 6]
      });
    }
    
    // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã‚¹ãƒãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    fetch('/api/overpass-spots')
      .then(response => response.json())
      .then(result => {
        loading.classList.remove('active');
        
        if (!result.success) {
          alert('ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
          return;
        }
        
        console.log(`å–å¾—ã—ãŸã‚¹ãƒãƒƒãƒˆæ•°: ${result.count}ä»¶`);
        
        // å„ã‚¹ãƒãƒƒãƒˆã«ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
        result.spots.forEach(function(spot) {
          // ã‚«ã‚¹ã‚¿ãƒ ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½¿ç”¨
          const icon = createCustomIcon(spot.type);
          
          // ãƒãƒ¼ã‚«ãƒ¼ã‚’ä½œæˆ
          var marker = L.marker([spot.lat, spot.lon], { icon: icon }).addTo(map);
          
          // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®å†…å®¹ã‚’ä½œæˆ
          var popupContent = `
            <div class="popup-title">${spot.name}</div>
            <span class="popup-type">${spot.type}</span>
          `;
          
          if (spot.address) {
            popupContent += `<div class="popup-address">ğŸ“ ${spot.address}</div>`;
          }
          
          if (spot.description) {
            popupContent += `<div style="margin-top:5px; font-size:12px;">${spot.description}</div>`;
          }
          
          if (spot.website) {
            popupContent += `<div style="margin-top:5px;"><a href="${spot.website}" target="_blank" style="color:#667eea;">ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ</a></div>`;
          }
          
          marker.bindPopup(popupContent);
        });
        
        console.log('ã™ã¹ã¦ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ');
      })
      .catch(error => {
        loading.classList.remove('active');
        console.error('é€šä¿¡ã‚¨ãƒ©ãƒ¼:', error);
        alert('ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ');
      });
  </script>
</body>
</html>
